FROM node:20

ARG DEBIAN_FRONTEND=noninteractive

# 如果没有特别需要不要配置
ENV BING_HEADER "Y3VybCAnaHR0cHM6Ly93d3cuYmluZy5jb20vdHVyaW5nL2NhcHRjaGEvY2hhbGxlbmdlJyBcICAgLUggJ2F1dGhvcml0eTogd3d3LmJpbmcuY29tJyBcICAgLUggJ2FjY2VwdDogdGV4dC9odG1sLGFwcGxpY2F0aW9uL3hodG1sK3htbCxhcHBsaWNhdGlvbi94bWw7cT0wLjksaW1hZ2Uvd2VicCxpbWFnZS9hcG5nLCovKjtxPTAuOCxhcHBsaWNhdGlvbi9zaWduZWQtZXhjaGFuZ2U7dj1iMztxPTAuNycgXCAgIC1IICdhY2NlcHQtbGFuZ3VhZ2U6IHpoLUNOLHpoO3E9MC45LGVuO3E9MC44LGVuLUdCO3E9MC43LGVuLVVTO3E9MC42JyBcICAgLUggJ2NhY2hlLWNvbnRyb2w6IG1heC1hZ2U9MCcgXCAgIC1IICdjb29raWU6IF9DX0F1dGg9OyBNVUlEPTM1RkE5RjE1MDYzMDZDNUEyQzNGOENFRjA3REE2REVDOyBNVUlEQj0zNUZBOUYxNTA2MzA2QzVBMkMzRjhDRUYwN0RBNkRFQzsgU1JDSEQ9QUY9QU5BQjAxOyBTUkNIVUlEPVY9MiZHVUlEPTQyNDIwNzI2RTRGODQ5N0Q5RDdBQjQxMjkyQzg4REYyJmRtbmNoZz0xOyBBTk9OPUE9OEYwODk4NUIxRUY4OEY1QkJGN0M5MTRGRkZGRkZGRkYmRT0xZDU1Jlc9MTsgTkFQPVY9MS45JkU9MWNmYiZDPVRialR6UEFpdFh1VGZxRXZOblRZeW1ka0xVeWRmNno4SW5pSThVLXdUdzJlSVBzaHZ3N0NidyZXPTE7IFBQTFN0YXRlPTE7IE1TQ0NTQz0xOyBTbnJPdnI9WD1yZWJhdGVzb247IE1TUFRDPXBtbWVwTDcyRXI5aEJtaG5nLS10VUhPdHRaaEtHMnRYMHh1V1JHY0p3TEk7IEVER1NSQ0hIUEdVU1I9Q0lCVj0xLjE1MjUuMjsgR0lfRlJFX0NPT0tJRT1naV9wcm9tcHQ9MTsgQU5JTUlBPUZSRT0xOyBLaWV2UlBTU2VjQXV0aD1GQUJpQkJSYVRPSklMdEZzTWtwTFZXU0c2QU42Qy9zdlJ3Tm1BQUFFZ0FBQUNGMnhTbTI2a0dHTklBU25UWmxiVlMwYS9KdldLYXJNUVRRNkNwRmZzakZWSVFCd3d6TGJkU1k0QXRDOVFHRjU4YkQ1YWF3YjIvU1Jmeks1WTZQMjhRRmh6VytiSGRncktuRHpBZmxpRjJ3QzZBbTNIelFuelNrRG4xQU93d3BUVSt1dzljZmI2cmZEMk5zcjhxODVGaGJaclArL0dROXNhRkRGdDBLL0xsQlZ5bnBEc2U0cThyMFpYZGI1UDFHWFg3aU9lMTJKKzB1QU1FSm1ienk4NUpvclhRVGVnZ2hWVThYU3ZtVjJLZG1XZFE2VVFhblMrbUMzQUhPSXNuV29oT2lLZVExQk9yM2lNNUJ4S21WV1hvdUphTjFsb0tSWWdWV0hqUzhPeTZGd1ZqakdSb1ZsS0UvdCtFMDB0bklmSmdjWWpXblZSd1VwQWdhMVNWMzVNWmpZRVVXVjJKZkpvd2ZBakc5WXV0VDVCM1VPQzlSZkk4UGppZXJBRW0wZzNBS0pYQnpSTUFxYmRpZnN5UWZHeWRPUFg0bXUzYU03TmJWckVHYnMzWG4vaktXTDFwTUZTRUs3S2FXaklGd0tpTjJ4cysxcGpVZ2JuNG9JT2o5dG9vd1dlaWtlL1lxdmN0QnF5clZxMHpjMS9iMVliWUNHdGsyMXZrVkt3bng2S2NQdmJmSHMyV0xTeVlwem8rayt3Mzl6WFF3RlVaWXpLc1UwUFU2UWNJSFNqL2tDeHFSdlEzUW9BU29TL0FtVk8vTlV4YWNEWUExSmNrbmh4aE1Za0s0cHJaa0JSbVNYQWJKNGdSMW5EcGpiTlJIN09adXNEM2hISk52ajhKY0tXZ2hnZWFkanBLbkVCRTJpcFhiQTVBTldRWDVGQ1NEYUtVeXErWUZxbUZId2NrekNOT2lITkUxMjVsSGdkaldwV095cFZpUmJESTg3bEtBazV6NEc4MFE1SzBObkxuZVJoVXcvemRXZk1YU0tjbUdxZ0htWGEyWS9EVFhPeTk3c2Z0em9XaXJ2TlBYVW1OV25Kc050cTAxaGNELzhyQXZvZ2Y2NFovYU4rSTBvOGVESXpsOHNyU0dheEhyYVN6Y2FMazB4N3FNWGNxQ1Q2aHRJK3VoTXFLblVYSmFYRTQvcUpycUpLVVhwdEJGQi9BVDFBUTdzUnQyd2lEY3o0eTV1dkxVTFdPeTlQcUd1dEx6M0xmL1FLaGxRWjh4bWVFM2dNRTFadTlWcXFrT01sTVVRRTlXRmhIUENTTUJMVGI5REhTdUtTUWNXL0p3bHhUSW1idmtWR1NKUWFWVkhUbGl5N3NkcVIrMDdvMGNjbUJTbmVrNm1yTVJOSU1oWWVQVkNtd2pCbjdxMnhQTEJqb05TZ0pEbisrK0g2SEJ3cVpEVWo2Zm5lQWxXb1d0eWsvSU9PV3k0SlhLMnNYZVZ0b21Fc3U1ZU1zbjVjWXBQMUJRU1ljZmY4M3YvbmsvaXhGbnZUQ0RqUGNYWEt4dTJGRUZ3QU5MK29YeFYvZzFRTE5Ta0hPcitiV1kvS2E0cVRhZy9yeHRub1MyR2YwMFkvNmxXS2hYdnVxczMzSzZBdTRRNlczTm5Ea2VCaGg4N2hxTHZLOWRZS0U3UjNZQXdFNmRySlBkbGREWnZPQWZCSkk1dEk1TjFObmNRT3dFbG5JZGxRZ1RDZ1pEeGFWNHBrUVFWclRRSVRLTS9JK01OcGRNdFp1VVFMRHRJamJXR3RTaUtoUlo5ajVMVS83WnltNnMrSmY4ZHk5VmRRa1QvdDlnQmY4VnpPall5UEIxdDc4NWFMMmhobFR2d2RvTFFLSXdvRy9WanJtT2xNeFdzWGFFM3MvaE1uWVlMRkx0cmlSbmlaYnA0SjJUNlgvTW1haEFVQUVLbFEySldBcEFKV1dPNzlpNndpeExmRG9xRTsgX1U9MVVRalpva3oxWXgxOFViUXZvNGN5OVFOcU5hMjRrNXh0MEhmXzZsUUl1MUFyQUh1UFBxai1JTmZKbXU2aHVOVVo3Rk9WMjFCTVRYRzFvZEl6d05malhSUTVuQ2ZYZFpPbjlFNWd5VzVUZDRWSi10LWY3SUNHVVRlWjdvZWJWUzZsUElvVVhOTW9kRUIteURwUWE0X1VHUXdldkZleWUxbFhiTnhOTkZySlFEOGdMdFluc3hMU3dGT0xzSzkxRlFMc0NXQnNfaW1YQm16Rkt6V245TjhBTFoweTFaNjZhOEVtb3VNdnFianctR0U7IF9jbGNrPTE4emxyazklN0MyJTdDZmo0JTdDMCU3QzE0ODg7IFdMSUQ9VmF5UGVoR21zd2p4V1V3cE9LSnRZTEVLdUxaUUc5aE9TdXBHT2RuWklISmpsdzBlTFR6SGdXb2RoWEZqOVJLd1RyeHRidkNHczJDRDV4SkVHaW5IT3V0Y3RDbVY5UTlPck9XR0ovOWhUdmM9OyBfdGFyTGFuZz1kZWZhdWx0PXpoLUhhbnM7IF9UVFNTX09VVD1oaXN0PVd5SjZhQzFJWVc1eklsMD07IF9UVFNTX0lOPWhpc3Q9V3lKbGJpSXNJbXBoSWl3aVlYVjBieTFrWlhSbFkzUWlYUT09JmlzQURSVT0wOyBBQkRFRj1WPTEzJkFCRFY9MTMmTVJOQj0xNzA4NDEwMzk3MDM5Jk1SQj0wOyBVU1JMT0M9SFM9MSZFTE9DPUxBVD0yOS41NjYxMTQ0MjU2NTkxOHxMT049MTA2LjQ1MjkzNDI2NTEzNjcyfE49JUU2JUIyJTk5JUU1JTlEJUFBJUU1JTlEJTlEJUU1JThDJUJBJUVGJUJDJThDJUU5JTg3JThEJUU1JUJBJTg2JUU1JUI4JTgyfEVMVD00fDsgU1JDSFVTUj1ET0I9MjAyNDAxMjUmVD0xNzA4NjgxMDAxMDAwJlBPRVg9VzsgX1J3QmY9cj0xJmlsdD0xJmlocGQ9MCZpc3BkPTEmcmM9MTM4JnJiPTEzOCZnYj0wJnJnPTAmcGM9MTM4Jm10dT0wJnJiYj0wLjAmZz0wJmNpZD0mY2xvPTAmdj0xJmw9MjAyNC0wMi0yM1QwODowMDowMC4wMDAwMDAwWiZsZnQ9MDAwMS0wMS0wMVQwMDowMDowMC4wMDAwMDAwJmFvZj0wJmFyZD0wMDAxLTAxLTAxVDAwOjAwOjAwLjAwMDAwMDAmcndkYnQ9MDAwMS0wMS0wMVQxNjowMDowMC4wMDAwMDAwLTA4OjAwJm89MCZwPWJpbmdjb3BpbG90d2FpdGxpc3QmYz1NWTAwSUEmdD04ODM3JnM9MjAyMy0wMy0xMVQxMTo0MDowMy4yOTU5MjkxKzAwOjAwJnRzPTIwMjQtMDItMjNUMDk6MzY6NDMuODk0NTM2MiswMDowMCZyd3JlZD0wJndscz0yJndsYj0wJndsZT0wJmNjcD0wJmxrYT0wJmxrdD0wJmFhZD0wJlRIPSZtdGE9MCZlPWFoSXNmb3NSZENyMDdPXzczUHdSWm5abE45TmxXS1p1Tzh3eER2R05xRlJxV2RNMmRKenJET2JrVGxXSDdaN193RlZiRlFjeG1hWDVaSExmMUN4YTF3JkE9JnJ3Zmx0PTIwMjQtMDEtMjhUMDE6NDA6NTQuOTk0Mzg4NC0wODowMDsgU1JDSEhQR1VTUj1TUkNITEFORz16aC1IYW5zJlBWPTEwLjAuMCZJRz0wMjQ1MjUyMTQzMzY0ODBBQjBGODY0RTExMEE5MUUwMiZCUlc9WFcmQlJIPU0mQ1c9MTU5MCZDSD03MTUmU0NXPTE1OTAmU0NIPTExMiZEUFI9MS4yJlVUQz00ODAmRE09MCZDSUJWPTEuMTU4Ni4xLW5vZGVzaWduJkVYTFRUPTMxJkhWPTE3MDg2ODEwMDQmY2R4dG9uZT1DcmVhdGl2ZSZjZHh0b25lb3B0cz1oM2ltYWdpbmF0aXZlLGdlbmNvbnRlbnR2MyxmbHV4bWVtY3N0JlBSVkNXPTE1OTAmUFJWQ0g9NzE1JkJaQT0wJldUUz02Mzg0MzA5MTM2MiZjZHh0cz0xOyBfQ19FVEg9MTsgR0M9Zzk4Mmkta0w5dmZScm94Qi1ycHFNbDgySXY2X1dnUFNhMk5FQk5QMWtveUJkQ0FOaVdiTGlNaHI2YVFiSzZOdkR2RDZMN3dSQVhndEdmaEVTLUFVLXc7IFdMUz1DPThlMTcyMjAyZGYzZDE5NDEmTj0lZTUlYTUlYjY7IF9TUz1TSUQ9MDMzMTZFRjdGRUE2NjAyNjExMDA3QUQ5RkYxMzYxRDk7IF9FREdFX1M9U0lEPTAzMzE2RUY3RkVBNjYwMjYxMTAwN0FEOUZGMTM2MUQ5Jm1rdD1lbi11cyZ1aT16aC1jbjsgY2N0PTVic09oeUR5NmJTWnRrRXFBWTJGWTI3c2hOdWwtSzdQalBIRUMwMFJFUndqdHNwOW1RcFk1MDRQV25mdTRmaXV1eDhUcDRTcjlpWkhhandmbFNEdVRRJyBcICAgLUggJ3NlYy1jaC11YTogIkNocm9taXVtIjt2PSIxMTgiLCAiTWljcm9zb2Z0IEVkZ2UiO3Y9IjExOCIsICJOb3Q9QT9CcmFuZCI7dj0iOTkiJyBcICAgLUggJ3NlYy1jaC11YS1hcmNoOiAieDg2IicgXCAgIC1IICdzZWMtY2gtdWEtYml0bmVzczogIjY0IicgXCAgIC1IICdzZWMtY2gtdWEtZnVsbC12ZXJzaW9uOiAiMTE4LjAuMjA4OC43NiInIFwgICAtSCAnc2VjLWNoLXVhLWZ1bGwtdmVyc2lvbi1saXN0OiAiQ2hyb21pdW0iO3Y9IjExOC4wLjU5OTMuMTE4IiwgIk1pY3Jvc29mdCBFZGdlIjt2PSIxMTguMC4yMDg4Ljc2IiwgIk5vdD1BP0JyYW5kIjt2PSI5OS4wLjAuMCInIFwgICAtSCAnc2VjLWNoLXVhLW1vYmlsZTogPzAnIFwgICAtSCAnc2VjLWNoLXVhLW1vZGVsOiAiIicgXCAgIC1IICdzZWMtY2gtdWEtcGxhdGZvcm06ICJXaW5kb3dzIicgXCAgIC1IICdzZWMtY2gtdWEtcGxhdGZvcm0tdmVyc2lvbjogIjEwLjAuMCInIFwgICAtSCAnc2VjLWZldGNoLWRlc3Q6IGRvY3VtZW50JyBcICAgLUggJ3NlYy1mZXRjaC1tb2RlOiBuYXZpZ2F0ZScgXCAgIC1IICdzZWMtZmV0Y2gtc2l0ZTogbm9uZScgXCAgIC1IICdzZWMtZmV0Y2gtdXNlcjogPzEnIFwgICAtSCAnc2VjLW1zLWdlYzogNkNCOTc5OTU3NTExQUNBOUJDOTVFMDI5NUM4NzM2RkNFMDg4ODQ2OUMwREY5RjhENTBBMEQyRUE4OUMxMThBQicgXCAgIC1IICdzZWMtbXMtZ2VjLXZlcnNpb246IDEtMTE4LjAuMjA4OC43NicgXCAgIC1IICd1cGdyYWRlLWluc2VjdXJlLXJlcXVlc3RzOiAxJyBcICAgLUggJ3VzZXItYWdlbnQ6IE1vemlsbGEvNS4wIChXaW5kb3dzIE5UIDEwLjA7IFdpbjY0OyB4NjQpIEFwcGxlV2ViS2l0LzUzNy4zNiAoS0hUTUwsIGxpa2UgR2Vja28pIENocm9tZS8xMTguMC4wLjAgU2FmYXJpLzUzNy4zNiBFZGcvMTE4LjAuMjA4OC43NicgXCAgIC1IICd4LWNsaWVudC1kYXRhOiBleUl4SWpvaU1URWlMQ0l4TUNJNklsd2lTaXRXZUM5aVdUZElOREIyYkdJMFdraFhPVmxyUTIxNlZtZEdRWEkyTm14c1YxQmxPRVZyYjJkV2R6MWNJaUlzSWpJaU9pSXhJaXdpTXlJNklqQWlMQ0kwSWpvaUxUY3pORFUyTXpVeU5qTXpPRGcwTURBMU9EY2lMQ0kxSWpvaVhDSXhXRlU1U1ZCVFFUSkllRzh2WlRKYVNrUTFNRFYyV2s4NGNHVkZVaTk1Y1d4dFMwcG1lRGxDYzJ0blBWd2lJaXdpTmlJNkluTjBZV0pzWlNJc0lqY2lPaUkxTnpneE1ESTFPVGd3TkRNd0lpd2lPU0k2SW1SbGMydDBiM0FpZlE9PScgXCAgIC1IICd4LWVkZ2Utc2hvcHBpbmctZmxhZzogMScgXCAgIC0tY29tcHJlc3NlZA=="

# Set home to the user's home directory
ENV HOME=/home/user \
  PATH=/home/user/.local/bin:$PATH

# Set up a new user named "user" with user ID 1000
RUN useradd -o -u 1000 user && mkdir -p $HOME/app && chown -R user $HOME

# Switch to the "user" user
USER user

# Set the working directory to the user's home directory
WORKDIR $HOME/app

# Copy the current directory contents into the container at $HOME/app setting the owner to the user
COPY --chown=user . $HOME/app/

RUN if [ ! -f ".next/routes-manifest.json" ]; then \
  npm install && npm run build; \
  fi

RUN rm -rf src

ENV PORT 7860

EXPOSE 7860

CMD npm start
